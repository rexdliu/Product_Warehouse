# æ•°æ®åº“ SQL æ–‡ä»¶ä½¿ç”¨è¯´æ˜

## ğŸ“ æ–‡ä»¶è¯´æ˜

### 1. `schema.sql` - æ•°æ®åº“è¡¨ç»“æ„
åŒ…å«æ‰€æœ‰è¡¨çš„å»ºè¡¨è¯­å¥ï¼Œç”¨äºåˆ›å»ºæ•°æ®åº“ç»“æ„ã€‚

### 2. `seed_test_data.sql` - æµ‹è¯•æ•°æ®
åŒ…å«å®Œæ•´çš„æµ‹è¯•æ•°æ®ï¼Œç”¨äºå¼€å‘ç¯å¢ƒã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šç›´æ¥ä½¿ç”¨ SQL æ–‡ä»¶ï¼ˆæ¨èç”¨äºå¿«é€Ÿæµ‹è¯•ï¼‰

```bash
# 1. ç™»å½• MySQL/RDS
mysql -h rm-xxxxx.mysql.rds.aliyuncs.com -u username -p

# 2. åˆ›å»ºæ•°æ®åº“
CREATE DATABASE IF NOT EXISTS warehouse_test_data DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# 3. ä½¿ç”¨æ•°æ®åº“
USE warehouse_test_data;

# 4. æ‰§è¡Œå»ºè¡¨è¯­å¥
source /path/to/database/schema.sql;

# 5. å¯¼å…¥æµ‹è¯•æ•°æ®
source /path/to/database/seed_test_data.sql;
```

æˆ–è€…ä½¿ç”¨å‘½ä»¤è¡Œä¸€é”®å¯¼å…¥ï¼š

```bash
# å»ºè¡¨
mysql -h rm-xxxxx.mysql.rds.aliyuncs.com -u username -p warehouse_test_data < database/schema.sql

# å¯¼å…¥æµ‹è¯•æ•°æ®
mysql -h rm-xxxxx.mysql.rds.aliyuncs.com -u username -p warehouse_test_data < database/seed_test_data.sql
```

### æ–¹å¼äºŒï¼šä½¿ç”¨ Python è„šæœ¬ï¼ˆå·²ç§»é™¤ï¼‰

åŸ `seed_data.py` è„šæœ¬å·²ä¸å†ä½¿ç”¨ï¼Œç°åœ¨ç»Ÿä¸€ä½¿ç”¨ SQL æ–‡ä»¶ã€‚

## ğŸ” æµ‹è¯•è´¦å·

æµ‹è¯•æ•°æ®ä¸­åŒ…å«ä»¥ä¸‹è´¦å·ï¼š

| ç”¨æˆ·å | å¯†ç  | è§’è‰² | æƒé™ |
|-------|------|------|------|
| admin | admin123 | admin | å®Œå…¨è®¿é—®æƒé™ |
| manager | manager123 | manager | ç®¡ç†è®¢å•å’Œåº“å­˜ |
| staff | staff123 | staff | åªè¯»æƒé™ |

**æ³¨æ„**: å¯†ç å·²ä½¿ç”¨ bcrypt åŠ å¯†ï¼Œhash å€¼å·²åŒ…å«åœ¨ SQL æ–‡ä»¶ä¸­ã€‚

## ğŸ“Š æµ‹è¯•æ•°æ®å†…å®¹

- âœ… 3 ä¸ªç”¨æˆ·ï¼ˆadmin, manager, staffï¼‰
- âœ… 5 ä¸ªäº§å“åˆ†ç±»ï¼ˆå‘åŠ¨æœºã€é›¶é…ä»¶ã€æœºæ²¹ã€æ»¤èŠ¯ã€ä¼ æ„Ÿå™¨ï¼‰
- âœ… 12 ä¸ª Cummins äº§å“
- âœ… 3 ä¸ªä»“åº“ï¼ˆæˆéƒ½ã€é‡åº†ã€æ˜†æ˜ï¼‰
- âœ… 36 æ¡åº“å­˜è®°å½•ï¼ˆæ¯ä¸ªäº§å“åœ¨æ¯ä¸ªä»“åº“éƒ½æœ‰åº“å­˜ï¼‰
- âœ… 4 ä¸ªç»é”€å•†
- âœ… 10 ä¸ªé”€å”®è®¢å•ï¼ˆä¸åŒçŠ¶æ€ï¼‰
- âœ… 10 æ¡åº“å­˜äº¤æ˜“è®°å½•
- âœ… 10 æ¡æ´»åŠ¨æ—¥å¿—

## ğŸ”„ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ç›¸åŒçš„è¡¨ç»“æ„ï¼Œä½†ä¸å¯¼å…¥æµ‹è¯•æ•°æ®ï¼š

```bash
# 1. åˆ›å»ºç”Ÿäº§æ•°æ®åº“
CREATE DATABASE IF NOT EXISTS warehouse_product DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# 2. åªæ‰§è¡Œå»ºè¡¨è¯­å¥
mysql -h rm-xxxxx.mysql.rds.aliyuncs.com -u username -p warehouse_product < database/schema.sql

# 3. ä¸è¦å¯¼å…¥ seed_test_data.sql
```

ç”Ÿäº§ç¯å¢ƒéœ€è¦æ‰‹åŠ¨åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼š

```sql
-- åœ¨ç”Ÿäº§æ•°æ®åº“ä¸­åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼ˆå¯†ç éœ€è¦åº”ç”¨ç¨‹åºåŠ å¯†ï¼‰
INSERT INTO users (username, email, phone, full_name, hashed_password, role, is_superuser) VALUES
('admin', 'admin@yourcompany.com', 'è”ç³»ç”µè¯', 'ç®¡ç†å‘˜å§“å', 'é€šè¿‡åº”ç”¨ç¨‹åºåŠ å¯†çš„å¯†ç ', 'admin', TRUE);
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®åº“å­—ç¬¦é›†**: ä½¿ç”¨ `utf8mb4` ä»¥æ”¯æŒä¸­æ–‡å’Œè¡¨æƒ…ç¬¦å·
2. **å¤–é”®çº¦æŸ**: è¡¨ä¹‹é—´æœ‰å¤–é”®å…³ç³»ï¼Œåˆ é™¤æ•°æ®æ—¶æ³¨æ„çº§è”å½±å“
3. **å¯†ç å®‰å…¨**:
   - æµ‹è¯•ç¯å¢ƒå¯†ç : admin123, manager123, staff123
   - ç”Ÿäº§ç¯å¢ƒ: å¿…é¡»ä½¿ç”¨å¼ºå¯†ç å¹¶é€šè¿‡åº”ç”¨ç¨‹åºåŠ å¯†
4. **å¤‡ä»½**: ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰åŠ¡å¿…å¤‡ä»½æ•°æ®åº“
5. **æƒé™**: ç¡®ä¿æ•°æ®åº“ç”¨æˆ·æœ‰è¶³å¤Ÿçš„æƒé™æ‰§è¡Œ DDL å’Œ DML è¯­å¥

## ğŸ—‘ï¸ æ¸…ç†æ•°æ®

å¦‚éœ€é‡ç½®æ•°æ®åº“ï¼š

```sql
-- è­¦å‘Šï¼šè¿™å°†åˆ é™¤æ‰€æœ‰æ•°æ®ï¼

-- åˆ é™¤æ‰€æœ‰è¡¨ï¼ˆæŒ‰ä¾èµ–å…³ç³»å€’åºï¼‰
DROP TABLE IF EXISTS activity_logs;
DROP TABLE IF EXISTS sales_orders;
DROP TABLE IF EXISTS inventory_transactions;
DROP TABLE IF EXISTS inventory;
DROP TABLE IF EXISTS distributors;
DROP TABLE IF EXISTS warehouses;
DROP TABLE IF EXISTS products;
DROP TABLE IF EXISTS product_categories;
DROP TABLE IF EXISTS users;

-- ç„¶åé‡æ–°æ‰§è¡Œ schema.sql å’Œ seed_test_data.sql
```

---

## â“ ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ Alembicï¼Ÿ

### Alembic çš„ä¼˜åŠ¿

Alembic æ˜¯ä¸€ä¸ªæ•°æ®åº“è¿ç§»å·¥å…·ï¼Œä¸»è¦ç”¨äºï¼š

1. **ç‰ˆæœ¬æ§åˆ¶**: è·Ÿè¸ªæ•°æ®åº“ schema çš„æ¯ä¸€æ¬¡å˜æ›´
2. **è‡ªåŠ¨ç”Ÿæˆè¿ç§»**: æ¯”è¾ƒæ¨¡å‹å’Œæ•°æ®åº“ï¼Œè‡ªåŠ¨ç”Ÿæˆè¿ç§»è„šæœ¬
3. **å›æ»šæ”¯æŒ**: å¯ä»¥å›æ»šåˆ°ä»»æ„å†å²ç‰ˆæœ¬
4. **å›¢é˜Ÿåä½œ**: å¤šäººå¼€å‘æ—¶é¿å… schema å†²çª

### ä¸ºä»€ä¹ˆå½“å‰é¡¹ç›®ä¸éœ€è¦ Alembicï¼Ÿ

#### 1. **é¡¹ç›®é˜¶æ®µè€ƒè™‘**
- å½“å‰å¤„äºåˆæœŸå¼€å‘é˜¶æ®µï¼Œè¡¨ç»“æ„å˜åŒ–é¢‘ç¹
- ä½¿ç”¨ SQL æ–‡ä»¶æ›´ç›´è§‚ã€æ›´å®¹æ˜“ç†è§£
- å¯ä»¥å¿«é€Ÿåˆ é™¤é‡å»ºï¼Œæ— éœ€ç»´æŠ¤å¤æ‚çš„è¿ç§»å†å²

#### 2. **å›¢é˜Ÿè§„æ¨¡**
- å°å›¢é˜Ÿæˆ–ä¸ªäººé¡¹ç›®ï¼Œschema å†²çªå°‘
- ç›´æ¥ä½¿ç”¨ SQL æ›´ç®€å•å¿«æ·

#### 3. **éƒ¨ç½²åœºæ™¯**
- å¼€å‘ç¯å¢ƒï¼šç›´æ¥åˆ é™¤é‡å»ºæ•°æ®åº“å³å¯
- ç”Ÿäº§ç¯å¢ƒï¼šåˆæ¬¡éƒ¨ç½²ï¼Œè¿˜æ²¡æœ‰éœ€è¦è¿ç§»çš„å†å²æ•°æ®

#### 4. **ç»´æŠ¤æˆæœ¬**
- Alembic éœ€è¦å­¦ä¹ æˆæœ¬å’Œç»´æŠ¤æˆæœ¬
- SQL æ–‡ä»¶å¯¹æ‰€æœ‰äººéƒ½å®¹æ˜“ç†è§£å’Œç»´æŠ¤

### ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨ Alembicï¼Ÿ

æ¨èåœ¨ä»¥ä¸‹æƒ…å†µä¸‹å¼•å…¥ Alembicï¼š

âœ… **ç”Ÿäº§ç¯å¢ƒå·²ä¸Šçº¿**ï¼Œæœ‰çœŸå®æ•°æ®ä¸èƒ½åˆ é™¤é‡å»º
âœ… **å¤šäººåä½œå¼€å‘**ï¼Œé¢‘ç¹ä¿®æ”¹æ•°æ®åº“ç»“æ„
âœ… **éœ€è¦ç‰ˆæœ¬æ§åˆ¶**ï¼Œèƒ½å¤Ÿå›æ»šåˆ°å†å²ç‰ˆæœ¬
âœ… **å¤æ‚çš„è¿ç§»é€»è¾‘**ï¼Œå¦‚æ•°æ®è½¬æ¢ã€è¡¨æ‹†åˆ†ç­‰

### å¦‚ä½•è¿‡æ¸¡åˆ° Alembicï¼Ÿ

å¦‚æœå°†æ¥éœ€è¦ä½¿ç”¨ Alembicï¼Œå¯ä»¥è¿™æ ·åšï¼š

```bash
# 1. åˆå§‹åŒ– Alembic
cd src/Backend
alembic init alembic

# 2. é…ç½® alembic.ini å’Œ env.py
# è¿æ¥åˆ°ç°æœ‰æ•°æ®åº“

# 3. åˆ›å»ºåˆå§‹è¿ç§»ï¼ˆåŸºäºå½“å‰ schemaï¼‰
alembic revision --autogenerate -m "Initial migration"

# 4. ä¹‹åçš„å˜æ›´éƒ½é€šè¿‡ Alembic ç®¡ç†
alembic revision --autogenerate -m "Add new column"
alembic upgrade head
```

## ğŸ“ æ€»ç»“

### å½“å‰æ¨èæ–¹æ¡ˆï¼šä½¿ç”¨ SQL æ–‡ä»¶

**ä¼˜åŠ¿**:
- âœ… ç®€å•ç›´è§‚ï¼Œå®¹æ˜“ç†è§£
- âœ… å¿«é€Ÿéƒ¨ç½²å’Œé‡ç½®
- âœ… é€‚åˆå¼€å‘é˜¶æ®µå¿«é€Ÿè¿­ä»£
- âœ… æ— éœ€é¢å¤–å­¦ä¹ æˆæœ¬
- âœ… ä¸ä»»ä½• ORM æ— å…³ï¼Œé€šç”¨æ€§å¼º

**åŠ£åŠ¿**:
- âŒ æ— ç‰ˆæœ¬æ§åˆ¶å†å²
- âŒ ä¸æ”¯æŒè‡ªåŠ¨å›æ»š
- âŒ ç”Ÿäº§ç¯å¢ƒæ›´æ–°éœ€è¦æ‰‹åŠ¨ç¼–å†™ SQL

### æœªæ¥å¯é€‰æ–¹æ¡ˆï¼šAlembic

ç­‰åˆ°é¡¹ç›®è¿›å…¥ä»¥ä¸‹é˜¶æ®µå†è€ƒè™‘ï¼š
1. ç”Ÿäº§ç¯å¢ƒæ­£å¼ä¸Šçº¿
2. æœ‰çœŸå®ä¸šåŠ¡æ•°æ®éœ€è¦ä¿æŠ¤
3. å›¢é˜Ÿè§„æ¨¡æ‰©å¤§ï¼Œéœ€è¦åä½œ
4. Schema å˜æ›´é¢‘ç¹ä½†éœ€è¦ç¨³å®š

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [DATABASE_SCHEMA.md](../DATABASE_SCHEMA.md) - è¯¦ç»†çš„æ•°æ®åº“è®¾è®¡æ–‡æ¡£
- [DEPLOYMENT.md](../DEPLOYMENT.md) - éƒ¨ç½²é…ç½®æ–‡æ¡£
- [README.md](../README.md) - é¡¹ç›®æ€»ä½“è¯´æ˜
