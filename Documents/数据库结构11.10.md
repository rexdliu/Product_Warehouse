# Product Warehouse - æ•°æ®åº“ Schema è®¾è®¡

## ä¸šåŠ¡åœºæ™¯
ç‰©æµå…¬å¸ä»“åº“ç®¡ç†ç³»ç»Ÿ - ä¸“é—¨å¤„ç† Cumminsï¼ˆåº·æ˜æ–¯ï¼‰é›¶ä»¶ã€å‘åŠ¨æœºã€æœºæ²¹ç­‰äº§å“

---

## ğŸ“‹ æ•°æ®è¡¨è®¾è®¡

### 1. users (ç”¨æˆ·è¡¨)
å­˜å‚¨ç³»ç»Ÿç”¨æˆ·ä¿¡æ¯

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | çº¦æŸ |
|------|------|------|------|
| id | Integer | ä¸»é”® | PK, Auto |
| username | String | ç”¨æˆ·å | Unique, Not Null |
| email | String | é‚®ç®± | Unique, Not Null |
| phone | String | æ‰‹æœºå· | Unique, Not Null |
| hashed_password | String | å¯†ç å“ˆå¸Œ | Not Null |
| full_name | String | å…¨å | - |
| role | String | è§’è‰² | Default: 'staff' |
| is_active | Boolean | æ˜¯å¦æ¿€æ´» | Default: True |
| is_superuser | Boolean | æ˜¯å¦è¶…çº§ç®¡ç†å‘˜ | Default: False |
| created_at | DateTime | åˆ›å»ºæ—¶é—´ | Auto |
| updated_at | DateTime | æ›´æ–°æ—¶é—´ | Auto |

**ç´¢å¼•**: username, email, phone

---

### 2. product_categories (äº§å“åˆ†ç±»è¡¨)
äº§å“åˆ†ç±»ï¼ˆå¦‚ï¼šé›¶ä»¶ã€å‘åŠ¨æœºã€æœºæ²¹ã€æ»¤èŠ¯ç­‰ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | çº¦æŸ |
|------|------|------|------|
| id | Integer | ä¸»é”® | PK, Auto |
| name | String | åˆ†ç±»åç§° | Unique, Not Null |
| code | String | åˆ†ç±»ä»£ç  | Unique |
| description | Text | æè¿° | - |
| created_at | DateTime | åˆ›å»ºæ—¶é—´ | Auto |

**ç¤ºä¾‹æ•°æ®**:
- å‘åŠ¨æœº (Engines)
- é›¶ä»¶ (Parts)
- æœºæ²¹ (Oils)
- æ»¤èŠ¯ (Filters)

---

### 3. products (äº§å“è¡¨) - **éœ€è¦ä¼˜åŒ–**
Cummins äº§å“ä¿¡æ¯

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | çº¦æŸ |
|------|------|------|------|
| id | Integer | ä¸»é”® | PK, Auto |
| name | String | äº§å“åç§° | Not Null |
| sku | String | SKUç¼–ç  | Unique, Not Null |
| **part_number** | **String** | **Cumminsé›¶ä»¶å·** | **Unique, Index** |
| **engine_model** | **String** | **é€‚ç”¨å‘åŠ¨æœºå‹å·** | **Index** |
| **manufacturer** | **String** | **åˆ¶é€ å•†** | **Default: 'Cummins'** |
| description | Text | äº§å“æè¿° | - |
| price | Float | å”®ä»· | Not Null |
| cost | Float | æˆæœ¬ä»· | - |
| **unit** | **String** | **å•ä½** | **Default: 'pcs'** |
| category_id | Integer | åˆ†ç±»ID | FK |
| **min_stock_level** | **Integer** | **æœ€ä½åº“å­˜é¢„è­¦** | **Default: 10** |
| image_url | String | å›¾ç‰‡URL | - |
| is_active | Boolean | æ˜¯å¦å¯ç”¨ | Default: True |
| created_at | DateTime | åˆ›å»ºæ—¶é—´ | Auto |
| updated_at | DateTime | æ›´æ–°æ—¶é—´ | Auto |

**æ–°å¢å­—æ®µè¯´æ˜**:
- `part_number`: Cumminså®˜æ–¹é›¶ä»¶å·ï¼Œå¦‚ "3803682"
- `engine_model`: é€‚ç”¨çš„å‘åŠ¨æœºå‹å·ï¼Œå¦‚ "6BT5.9", "ISF2.8"
- `manufacturer`: åˆ¶é€ å•†ï¼Œé»˜è®¤ Cummins
- `unit`: å•ä½ï¼ˆpcs=ä»¶, box=ç®±, liter=å‡ï¼‰
- `min_stock_level`: æœ€ä½åº“å­˜é¢„è­¦çº¿

**ç´¢å¼•**: sku, part_number, engine_model, category_id

---

### 4. warehouses (ä»“åº“è¡¨)
ä»“åº“ä¿¡æ¯

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | çº¦æŸ |
|------|------|------|------|
| id | Integer | ä¸»é”® | PK, Auto |
| name | String | ä»“åº“åç§° | Not Null |
| code | String | ä»“åº“ä»£ç  | Unique |
| location | String | ä½ç½®/åœ°å€ | - |
| **capacity** | **Float** | **æ€»å®¹é‡ï¼ˆç«‹æ–¹ç±³ï¼‰** | - |
| **current_usage** | **Float** | **å½“å‰ä½¿ç”¨é‡** | **Default: 0** |
| **manager_name** | **String** | **ä»“åº“ç®¡ç†å‘˜** | - |
| **phone** | **String** | **è”ç³»ç”µè¯** | - |
| is_active | Boolean | æ˜¯å¦å¯ç”¨ | Default: True |
| created_at | DateTime | åˆ›å»ºæ—¶é—´ | Auto |

**æ–°å¢å­—æ®µè¯´æ˜**:
- `current_usage`: å½“å‰ä½¿ç”¨çš„å®¹é‡ï¼Œç”¨äºè®¡ç®—ä½¿ç”¨ç‡
- `manager_name`: ä»“åº“ç®¡ç†å‘˜å§“å
- `phone`: è”ç³»ç”µè¯

---

### 5. inventories (åº“å­˜è¡¨)
äº§å“åœ¨å„ä»“åº“çš„åº“å­˜æ•°é‡

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | çº¦æŸ |
|------|------|------|------|
| id | Integer | ä¸»é”® | PK, Auto |
| product_id | Integer | äº§å“ID | FK, Not Null |
| warehouse_id | Integer | ä»“åº“ID | FK, Not Null |
| quantity | Integer | å¯ç”¨æ•°é‡ | Default: 0 |
| reserved_quantity | Integer | é¢„ç•™æ•°é‡ | Default: 0 |
| **location_code** | **String** | **è´§ä½ç¼–å·** | - |
| updated_at | DateTime | æ›´æ–°æ—¶é—´ | Auto |

**æ–°å¢å­—æ®µè¯´æ˜**:
- `location_code`: ä»“åº“å†…å…·ä½“è´§ä½ï¼Œå¦‚ "A-01-03"

**ç´¢å¼•**: (product_id, warehouse_id) è”åˆç´¢å¼•

---

### 6. inventory_transactions (åº“å­˜äº¤æ˜“è¡¨)
åº“å­˜å˜åŠ¨è®°å½•

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | çº¦æŸ |
|------|------|------|------|
| id | Integer | ä¸»é”® | PK, Auto |
| product_id | Integer | äº§å“ID | FK, Not Null |
| warehouse_id | Integer | ä»“åº“ID | FK, Not Null |
| transaction_type | String | äº¤æ˜“ç±»å‹ | Not Null |
| quantity | Integer | æ•°é‡ | Not Null |
| **user_id** | **Integer** | **æ“ä½œç”¨æˆ·** | **FK** |
| reference | String | å‚è€ƒå•å· | - |
| notes | String | å¤‡æ³¨ | - |
| created_at | DateTime | åˆ›å»ºæ—¶é—´ | Auto |

**äº¤æ˜“ç±»å‹ (transaction_type)**:
- `IN`: å…¥åº“
- `OUT`: å‡ºåº“
- `ADJUST`: è°ƒæ•´
- `TRANSFER`: è°ƒæ‹¨

**æ–°å¢å­—æ®µè¯´æ˜**:
- `user_id`: è®°å½•æ“ä½œäººå‘˜

---

### 7. distributors (ç»é”€å•†è¡¨)
ç»é”€å•†ä¿¡æ¯

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | çº¦æŸ |
|------|------|------|------|
| id | Integer | ä¸»é”® | PK, Auto |
| name | String | ç»é”€å•†åç§° | Unique, Not Null |
| **code** | **String** | **ç»é”€å•†ä»£ç ** | **Unique** |
| contact_person | String | è”ç³»äºº | Not Null |
| phone | String | ç”µè¯ | Not Null |
| **email** | **String** | **é‚®ç®±** | - |
| **address** | **String** | **åœ°å€** | - |
| region | String | åŒºåŸŸ | Not Null |
| **credit_limit** | **Float** | **ä¿¡ç”¨é¢åº¦** | **Default: 0** |
| **is_active** | **Boolean** | **æ˜¯å¦å¯ç”¨** | **Default: True** |
| created_at | DateTime | åˆ›å»ºæ—¶é—´ | Auto |

**æ–°å¢å­—æ®µè¯´æ˜**:
- `code`: ç»é”€å•†ä»£ç ï¼Œå¦‚ "DIST001"
- `email`: ç”µå­é‚®ç®±
- `address`: è¯¦ç»†åœ°å€
- `credit_limit`: ä¿¡ç”¨é¢åº¦é™åˆ¶
- `is_active`: æ˜¯å¦å¯ç”¨è¯¥ç»é”€å•†

---

### 8. sales_orders (é”€å”®è®¢å•è¡¨) - **éœ€è¦ä¼˜åŒ–**
é”€å”®è®¢å•ä¿¡æ¯

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | çº¦æŸ |
|------|------|------|------|
| id | Integer | ä¸»é”® | PK, Auto |
| order_code | String | è®¢å•å· | Unique, Not Null |
| distributor_id | Integer | ç»é”€å•†ID | FK, Not Null |
| product_id | Integer | äº§å“ID | FK, Not Null |
| product_name | String | äº§å“åç§° | Not Null |
| quantity | Integer | æ•°é‡ | Not Null |
| **unit_price** | **Float** | **å•ä»·** | **Not Null** |
| total_value | Float | æ€»é‡‘é¢ | Not Null |
| **status** | **String** | **è®¢å•çŠ¶æ€** | **Default: 'pending'** |
| **warehouse_id** | **Integer** | **å‡ºè´§ä»“åº“** | **FK** |
| order_date | DateTime | ä¸‹å•æ—¥æœŸ | Not Null |
| **delivery_date** | **DateTime** | **äº¤è´§æ—¥æœŸ** | - |
| **completed_at** | **DateTime** | **å®Œæˆæ—¶é—´** | - |
| **user_id** | **Integer** | **åˆ›å»ºäºº** | **FK** |
| **notes** | **Text** | **å¤‡æ³¨** | - |
| created_at | DateTime | åˆ›å»ºæ—¶é—´ | Auto |
| updated_at | DateTime | æ›´æ–°æ—¶é—´ | Auto |

**è®¢å•çŠ¶æ€ (status)**:
- `pending`: å¾…å¤„ç†
- `processing`: å¤„ç†ä¸­
- `completed`: å·²å®Œæˆ
- `cancelled`: å·²å–æ¶ˆ
- `shipped`: å·²å‘è´§

**æ–°å¢å­—æ®µè¯´æ˜**:
- `unit_price`: å•ä»·
- `status`: è®¢å•çŠ¶æ€ï¼Œç”¨äº Dashboard ç»Ÿè®¡
- `warehouse_id`: å‡ºè´§ä»“åº“
- `delivery_date`: è®¡åˆ’äº¤è´§æ—¥æœŸ
- `completed_at`: å®é™…å®Œæˆæ—¶é—´
- `user_id`: åˆ›å»ºè®¢å•çš„ç”¨æˆ·
- `notes`: è®¢å•å¤‡æ³¨

**ç´¢å¼•**: order_code, distributor_id, status, order_date

---

### 9. activity_logs (æ´»åŠ¨æ—¥å¿—è¡¨) - **æ–°å¢**
ç»Ÿä¸€çš„æ´»åŠ¨æ—¥å¿—ï¼Œç”¨äº Dashboard æ˜¾ç¤º

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | çº¦æŸ |
|------|------|------|------|
| id | Integer | ä¸»é”® | PK, Auto |
| activity_type | String | æ´»åŠ¨ç±»å‹ | Not Null |
| action | String | æ“ä½œæè¿° | Not Null |
| item_name | String | é¡¹ç›®åç§° | - |
| user_id | Integer | æ“ä½œç”¨æˆ· | FK |
| reference_id | Integer | å…³è”ID | - |
| reference_type | String | å…³è”ç±»å‹ | - |
| created_at | DateTime | åˆ›å»ºæ—¶é—´ | Auto |

**æ´»åŠ¨ç±»å‹ (activity_type)**:
- `inventory`: åº“å­˜æ›´æ–°
- `order`: è®¢å•å¤„ç†
- `product`: äº§å“æ“ä½œ
- `alert`: è­¦æŠ¥

**ç¤ºä¾‹æ•°æ®**:
```
æ´»åŠ¨ç±»å‹: inventory, æ“ä½œ: "åº“å­˜å·²æ›´æ–°", é¡¹ç›®: "Cummins 6BT æ´»å¡", æ—¶é—´: 2åˆ†é’Ÿå‰
æ´»åŠ¨ç±»å‹: order, æ“ä½œ: "è®¢å•å·²å¤„ç†", é¡¹ç›®: "Order #WH-2024-045", æ—¶é—´: 15åˆ†é’Ÿå‰
```

---

## ğŸ“Š ER å›¾å…³ç³»

```
User (1) ----< (M) SalesOrder
User (1) ----< (M) InventoryTransaction
User (1) ----< (M) ActivityLog

ProductCategory (1) ----< (M) Product

Product (1) ----< (M) Inventory
Product (1) ----< (M) SalesOrder
Product (1) ----< (M) InventoryTransaction

Warehouse (1) ----< (M) Inventory
Warehouse (1) ----< (M) InventoryTransaction
Warehouse (1) ----< (M) SalesOrder

Distributor (1) ----< (M) SalesOrder
```

---

## ğŸ”„ æ•°æ®è¿ç§»è®¡åˆ’

### ç¬¬ä¸€æ­¥ï¼šæ·»åŠ æ–°å­—æ®µåˆ°ç°æœ‰è¡¨

1. **products è¡¨**:
   - æ·»åŠ : part_number, engine_model, manufacturer, unit, min_stock_level

2. **warehouses è¡¨**:
   - æ·»åŠ : code, current_usage, manager_name, phone

3. **sales_orders è¡¨**:
   - æ·»åŠ : status, unit_price, warehouse_id, delivery_date, completed_at, user_id, notes, updated_at

4. **distributors è¡¨**:
   - æ·»åŠ : code, email, address, credit_limit, is_active

5. **inventories è¡¨**:
   - æ·»åŠ : location_code

6. **inventory_transactions è¡¨**:
   - æ·»åŠ : user_id

7. **users è¡¨**:
   - æ·»åŠ : full_name, role

### ç¬¬äºŒæ­¥ï¼šåˆ›å»ºæ–°è¡¨

1. **activity_logs è¡¨**: æ–°å»ºæ´»åŠ¨æ—¥å¿—è¡¨

---

## ğŸ“ Dashboard API æ•°æ®æ¥æº

1. **pendingOrders** (å¾…å¤„ç†è®¢å•æ•°):
   ```sql
   SELECT COUNT(*) FROM sales_orders 
   WHERE status IN ('pending', 'processing')
   ```

2. **warehouseCapacity** (ä»“åº“å®¹é‡ä½¿ç”¨ç‡):
   ```sql
   SELECT 
     SUM(current_usage) / SUM(capacity) * 100 
   FROM warehouses 
   WHERE is_active = true
   ```

3. **recentActivities** (æœ€è¿‘æ´»åŠ¨):
   ```sql
   SELECT * FROM activity_logs 
   ORDER BY created_at DESC 
   LIMIT 10
   ```

4. **aiInsights** (AIæ´å¯Ÿ):
   åŸºäºè§„åˆ™ç”Ÿæˆï¼š
   - ä½åº“å­˜é¢„è­¦: `quantity < min_stock_level`
   - çƒ­é”€äº§å“åˆ†æ
   - å¼‚å¸¸è®¢å•æ£€æµ‹

---

**æœ€åæ›´æ–°**: 2025-11-10