# 数据库创建步骤

本文档详细说明如何创建和初始化 WarehouseAI 项目所需的数据库。

## 1. 环境准备

确保已安装以下依赖：

- Python 3.10+
- MySQL 8.0+（本地或云服务如AWS RDS）
- 项目依赖包（通过 `pip install -r requirements.txt` 安装）

## 2. 数据库配置

项目支持 MySQL 数据库。要使用 MySQL，需要修改 [src/Backend/app/core/config.py](file:///Users/liu/Desktop/Product_Warehouse/src/Backend/app/core/config.py) 文件中的配置：

```python
DATABASE_URL: str = "mysql+pymysql://username:password@host:port/database_name"
```

例如，对于 AWS RDS：
```python
DATABASE_URL: str = "mysql+pymysql://warehouse_user:secure_password@warehouse-db.cluster-xyz123.us-east-1.rds.amazonaws.com:3306/warehouse_db"
```

## 3. 数据库创建步骤

### 步骤 1: 创建数据库

在 MySQL 中创建数据库：

```sql
CREATE DATABASE warehouse_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 步骤 2: 创建数据库用户并授权

```sql
CREATE USER 'warehouse_user'@'%' IDENTIFIED BY 'secure_password';
GRANT ALL PRIVILEGES ON warehouse_db.* TO 'warehouse_user'@'%';
FLUSH PRIVILEGES;
```

### 步骤 3: 进入后端目录

```bash
cd src/Backend
```

### 步骤 4: 运行数据库初始化脚本


```

这将创建以下数据表：
- users: 用户表
- product_categories: 产品分类表
- warehouses: 仓库表
- products: 产品表
- inventories: 库存表
- inventory_transactions: 库存交易表

### 步骤 5: 验证数据库创建

可以通过以下方式验证数据库是否创建成功：

```bash
# 检查表结构
python -c "
from app.core.database import engine
from app.models import user, product, inventory
print('Database tables created successfully.')
"
```

## 4. 数据库表结构说明

### users 表
存储用户信息：
- id: 用户ID（主键）
- username: 用户名
- email: 邮箱
- hashed_password: 加密密码
- is_active: 是否激活
- is_superuser: 是否超级用户
- created_at: 创建时间
- updated_at: 更新时间
- theme: 主题设置
- notifications: 通知设置
- ai_settings: AI设置
- avatar_url: 头像URL

### product_categories 表
存储产品分类信息：
- id: 分类ID（主键）
- name: 分类名称
- description: 分类描述
- created_at: 创建时间

### products 表
存储产品信息：
- id: 产品ID（主键）
- name: 产品名称
- sku: 产品SKU
- description: 产品描述
- price: 价格
- cost: 成本
- category_id: 分类ID（外键）
- image_url: 图片URL
- is_active: 是否激活
- created_at: 创建时间
- updated_at: 更新时间

### inventories 表
存储库存信息：
- id: 库存ID（主键）
- product_id: 产品ID（外键）
- warehouse_id: 仓库ID（外键）
- quantity: 数量
- reserved_quantity: 预留数量
- available_quantity: 可用数量
- last_updated: 最后更新时间

### warehouses 表
存储仓库信息：
- id: 仓库ID（主键）
- name: 仓库名称
- location: 仓库位置
- capacity: 容量
- is_active: 是否激活
- created_at: 创建时间
- updated_at: 更新时间

### inventory_transactions 表
存储库存交易记录：
- id: 交易ID（主键）
- product_id: 产品ID（外键）
- warehouse_id: 仓库ID（外键）
- transaction_type: 交易类型
- quantity: 数量
- reference: 引用
- notes: 备注
- created_at: 创建时间
- created_by: 创建者

## 5. 前后端数据交互说明

### 前端需要的数据结构

1. 产品信息（用于库存管理页面）：
   - id: 产品ID
   - name: 产品名称
   - sku: 产品SKU
   - category: 产品分类
   - quantity: 库存数量
   - minStock: 最低库存量
   - price: 价格
   - location: 存放位置
   - status: 库存状态 ('in-stock' | 'low-stock' | 'out-of-stock')
   - lastUpdated: 最后更新时间

2. 经销商信息（用于销售查询页面）：
   - id: 经销商ID
   - name: 经销商名称
   - contactPerson: 联系人
   - phone: 联系电话
   - region: 所在地区

3. 销售订单信息（用于销售查询页面）：
   - orderId: 订单ID
   - distributorId: 经销商ID
   - productId: 产品ID
   - productName: 产品名称
   - quantity: 销售数量
   - totalValue: 订单总金额
   - orderDate: 订单日期

### 后端API接口

1. 产品管理接口：
   - GET /api/v1/products/ - 获取产品列表
   - POST /api/v1/products/ - 创建产品
   - GET /api/v1/products/{id} - 获取特定产品
   - PUT /api/v1/products/{id} - 更新产品
   - DELETE /api/v1/products/{id} - 删除产品

2. 库存管理接口：
   - GET /api/v1/inventory/warehouses - 获取仓库列表
   - POST /api/v1/inventory/warehouses - 创建仓库
   - GET /api/v1/inventory/items - 获取库存项目列表
   - GET /api/v1/inventory/items/{id} - 获取特定库存项目
   - PUT /api/v1/inventory/items/{id} - 更新库存项目

### 数据转换说明

后端返回的数据结构与前端需要的数据结构存在差异，需要进行适当的转换：

1. 产品信息转换：
   - 后端 Product 模型需要转换为前端 Product 接口
   - category_id 需要转换为 category 名称
   - 需要计算 status 字段（基于 quantity 和 minStock）
   - 需要合并库存信息（quantity, location 等）

2. 经销商和销售信息：
   - 当前版本使用模拟数据，后续需要连接真实的经销商和销售订单表

## 6. 重置数据库（可选）

如果需要重新创建数据库，可以运行：

```bash
python manage.py drop
python manage.py init
```

这将删除所有现有数据并重新创建空表。